<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×©×‘×•×Ÿ ×¨×™×‘×™×ª ×“×¨×™×‘×™×ª - ×’×¨×¡×” ××ª×§×“××ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        body {
            font-family: 'Assistant', sans-serif;
            background-color: #f1f5f9;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            box-shadow: 0 12px 24px -12px rgba(15, 23, 42, 0.35);
            border: 1px solid #e2e8f0;
        }
        .input-label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 600;
            font-size: 0.875rem;
            color: #475569;
        }
        .input-field {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            outline: none;
            transition: all 0.2s;
        }
        .input-field:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn.active {
            border-bottom-color: #2563eb;
            color: #2563eb;
        }
        .hero {
            background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.18), transparent 50%),
                        radial-gradient(circle at top left, rgba(16, 185, 129, 0.18), transparent 55%),
                        #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 24px 32px -24px rgba(15, 23, 42, 0.35);
        }
        .pill {
            background: rgba(59, 130, 246, 0.1);
            color: #1d4ed8;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.85rem;
            font-weight: 600;
        }
    </style>
</head>
<body class="p-4 md:p-8 bg-slate-50">
    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-8">
        <header class="text-center mb-8 hero">
            <div class="flex items-center justify-center gap-2 mb-3">
                <span class="pill">×’×¨×¡×” ××ª×§×“××ª</span>
                <span class="pill">×”×©×•×•××ª ×ª×•×›× ×™×•×ª</span>
            </div>
            <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">××—×©×‘×•×Ÿ ×¨×™×‘×™×ª ×“×¨×™×‘×™×ª ××ª×§×“×</h1>
            <p class="text-slate-500 mt-2 text-lg">×ª×›× ×•×Ÿ ×¤×™× × ×¡×™ ××§×¦×•×¢×™ ×›×•×œ×œ ××¡, ××™× ×¤×œ×¦×™×” ×•×”×©×•×•××”</p>
        </header>

        <!-- Toggle Mode -->
        <div class="flex justify-center mb-8">
            <div class="inline-flex bg-white p-1 rounded-xl shadow-sm border border-slate-200">
                <button id="btnSingle" onclick="setMode('single')" class="px-6 py-2 rounded-lg font-bold transition-all bg-blue-600 text-white shadow-sm">×ª×•×›× ×™×ª ××—×ª</button>
                <button id="btnCompare" onclick="setMode('compare')" class="px-6 py-2 rounded-lg font-bold transition-all text-slate-600 hover:bg-slate-100">×”×©×•×•××ª ×ª×•×›× ×™×•×ª</button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Settings Sidebar -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Basic Params -->
                <div class="card p-6 border-t-4 border-blue-600">
                    <h2 class="text-xl font-bold mb-4 text-slate-800 flex items-center gap-2">
                        <span>âš™ï¸</span> ×¤×¨××˜×¨×™× ×‘×¡×™×¡×™×™×
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <label class="input-label">×ª×§×•×¤×ª ×—×™×¡×›×•×Ÿ (×©× ×™×)</label>
                            <input type="number" id="years" value="20" class="input-field" oninput="calculate()">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="input-label">××¡ ×¨×•×•×—×™ ×”×•×Ÿ (%)</label>
                                <input type="number" id="taxRate" value="25" class="input-field" oninput="calculate()">
                            </div>
                            <div>
                                <label class="input-label">××™× ×¤×œ×¦×™×” ×©× ×ª×™×ª (%)</label>
                                <input type="number" id="inflationRate" value="2.5" class="input-field" oninput="calculate()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Plan A -->
                <div class="card p-6 border-t-4 border-blue-500">
                    <h2 id="titleA" class="text-lg font-bold mb-4 text-blue-600">×”×’×“×¨×•×ª ×ª×•×›× ×™×ª ×'</h2>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="input-label">×”×¤×§×“×” ×¨××©×•× ×™×ª</label>
                                <input type="number" id="initA" value="50000" class="input-field" oninput="calculate()">
                            </div>
                            <div>
                                <label class="input-label">×”×¤×§×“×” ×—×•×“×©×™×ª</label>
                                <input type="number" id="monthlyA" value="2000" class="input-field" oninput="calculate()">
                            </div>
                        </div>
                        <div>
                            <label class="input-label">×¨×™×‘×™×ª ×©× ×ª×™×ª ××¦×•×¤×” (%)</label>
                            <input type="number" id="interestA" value="7" step="0.1" class="input-field" oninput="calculate()">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="input-label">×“"×  ×¦×‘×™×¨×” (%)</label>
                                <input type="number" id="feesAccA" value="0.5" step="0.01" class="input-field" oninput="calculate()">
                            </div>
                            <div>
                                <label class="input-label">×“"×  ×”×¤×§×“×” (%)</label>
                                <input type="number" id="feesDepA" value="0" step="0.1" class="input-field" oninput="calculate()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Plan B (Hidden by default) -->
                <div id="planBContainer" class="card p-6 border-t-4 border-orange-500 hidden">
                    <h2 class="text-lg font-bold mb-4 text-orange-600">×”×’×“×¨×•×ª ×ª×•×›× ×™×ª ×‘'</h2>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="input-label">×”×¤×§×“×” ×¨××©×•× ×™×ª</label>
                                <input type="number" id="initB" value="50000" class="input-field" oninput="calculate()">
                            </div>
                            <div>
                                <label class="input-label">×”×¤×§×“×” ×—×•×“×©×™×ª</label>
                                <input type="number" id="monthlyB" value="2000" class="input-field" oninput="calculate()">
                            </div>
                        </div>
                        <div>
                            <label class="input-label">×¨×™×‘×™×ª ×©× ×ª×™×ª ××¦×•×¤×” (%)</label>
                            <input type="number" id="interestB" value="4.5" step="0.1" class="input-field" oninput="calculate()">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="input-label">×“"×  ×¦×‘×™×¨×” (%)</label>
                                <input type="number" id="feesAccB" value="0.2" step="0.01" class="input-field" oninput="calculate()">
                            </div>
                            <div>
                                <label class="input-label">×“"×  ×”×¤×§×“×” (%)</label>
                                <input type="number" id="feesDepB" value="0" step="0.1" class="input-field" oninput="calculate()">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Display -->
            <div class="lg:col-span-8 space-y-6">
                <!-- Summary Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="card p-5 bg-gradient-to-br from-blue-600 to-blue-700 text-white border-0">                        <p class="text-sm opacity-80">×¡×›×•× ×¡×•×¤×™ ×‘×¨×•×˜×•</p>
                        <h3 class="text-2xl font-bold" id="statFinalBruto">â‚ª0</h3>
                    </div>
                    <div class="card p-5 bg-white border-l-4 border-green-500">
                        <p class="text-sm text-slate-500">×¡×›×•× ×¡×•×¤×™ × ×˜×• (××—×¨×™ ××¡)</p>
                        <h3 class="text-2xl font-bold text-green-600" id="statFinalNeto">â‚ª0</h3>
                    </div>
                    <div class="card p-5 bg-white border-l-4 border-purple-500">
                        <p class="text-sm text-slate-500">×¢×¨×š ×¨×™××œ×™ (××ª×•×× ××™× ×¤×œ×¦×™×”)</p>
                        <h3 class="text-2xl font-bold text-purple-600" id="statRealValue">â‚ª0</h3>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="card overflow-hidden">
                    <div class="flex border-b border-slate-200 bg-slate-50">
                        <button onclick="setTab('graph')" id="tabGraph" class="tab-btn active">ğŸ“ˆ ×’×¨×£ ×¦××™×—×”</button>
                        <button onclick="setTab('table')" id="tabTable" class="tab-btn">ğŸ“‹ ×¤×™×¨×•×˜ ×©× ×ª×™</button>
                    </div>
                    
                    <div id="graphContent" class="p-6">
                        <div class="h-80 md:h-96 w-full">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>

                    <div id="tableContent" class="hidden p-6 overflow-x-auto">
                        <table class="w-full text-sm text-right">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="p-2 border">×©× ×”</th>
                                    <th class="p-2 border">×™×ª×¨×” ×œ×ª×—×™×œ×ª ×©× ×”</th>
                                    <th class="p-2 border">×”×¤×§×“×•×ª ×©× ×ª×™×•×ª</th>
                                    <th class="p-2 border">×¨×•×•×— ×©× ×ª×™</th>
                                    <th class="p-2 border">×“××™ × ×™×”×•×œ</th>
                                    <th class="p-2 border">×™×ª×¨×” ×œ×¡×•×£ ×©× ×”</th>
                                </tr>
                            </thead>
                            <tbody id="yearlyTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Detailed Summary Table -->
                <div class="card p-6">
                    <h3 class="font-bold text-lg mb-4 text-slate-800">×¡×™×›×•× × ×ª×•× ×™× ××©×•×•×”</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm border-collapse">
                            <thead>
                                <tr class="bg-slate-50">
                                    <th class="p-2 border text-right">× ×ª×•×Ÿ</th>
                                    <th class="p-2 border text-center text-blue-600">×ª×•×›× ×™×ª ×'</th>
                                    <th id="compHeadB" class="p-2 border text-center text-orange-600 hidden">×ª×•×›× ×™×ª ×‘'</th>
                                </tr>
                            </thead>
                            <tbody id="comparisonRows">
                                <!-- Rows dynamic -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let mode = 'single'; // single or compare
        let activeTab = 'graph';
        let mainChart = null;

        function setMode(newMode) {
            mode = newMode;
            const planB = document.getElementById('planBContainer');
            const compHeadB = document.getElementById('compHeadB');
            const btnSingle = document.getElementById('btnSingle');
            const btnCompare = document.getElementById('btnCompare');

            if (mode === 'compare') {
                planB.classList.remove('hidden');
                compHeadB.classList.remove('hidden');
                btnCompare.classList.add('bg-blue-600', 'text-white');
                btnCompare.classList.remove('text-slate-600');
                btnSingle.classList.remove('bg-blue-600', 'text-white');
                btnSingle.classList.add('text-slate-600');
            } else {
                planB.classList.add('hidden');
                compHeadB.classList.add('hidden');
                btnSingle.classList.add('bg-blue-600', 'text-white');
                btnSingle.classList.remove('text-slate-600');
                btnCompare.classList.remove('bg-blue-600', 'text-white');
                btnCompare.classList.add('text-slate-600');
            }
            calculate();
        }

        function setTab(tab) {
            activeTab = tab;
            document.getElementById('tabGraph').classList.toggle('active', tab === 'graph');
            document.getElementById('tabTable').classList.toggle('active', tab === 'table');
            document.getElementById('graphContent').classList.toggle('hidden', tab !== 'graph');
            document.getElementById('tableContent').classList.toggle('hidden', tab !== 'table');
        }

        function runProjection(init, monthly, annualInterest, annualAccFee, depFee, years) {
            const mInterest = (annualInterest / 100) / 12;
            const mAccFee = (annualAccFee / 100) / 12;
            const dFeeRate = depFee / 100;
            const months = years * 12;

            let balance = init;
            let totalDeposited = init;
            let totalFees = 0;
            let totalProfit = 0;
            
            const yearlyLog = [];
            const graphData = [Math.round(balance)];

            for (let y = 1; y <= years; y++) {
                let startOfYear = balance;
                let yearDeposits = 0;
                let yearProfit = 0;
                let yearFees = 0;

                for (let m = 1; m <= 12; m++) {
                    const netDeposit = monthly * (1 - dFeeRate);
                    const currentDepFee = monthly * dFeeRate;
                    yearFees += currentDepFee;
                    yearDeposits += monthly;
                    totalDeposited += monthly;

                    const profit = (balance + netDeposit) * mInterest;
                    yearProfit += profit;
                    balance += netDeposit + profit;

                    const accFee = balance * mAccFee;
                    yearFees += accFee;
                    balance -= accFee;
                }

                totalFees += yearFees;
                totalProfit += yearProfit;
                yearlyLog.push({
                    year: y,
                    start: Math.round(startOfYear),
                    deposits: Math.round(yearDeposits),
                    profit: Math.round(yearProfit),
                    fees: Math.round(yearFees),
                    end: Math.round(balance)
                });
                graphData.push(Math.round(balance));
            }

            return { balance, totalDeposited, totalFees, totalProfit, yearlyLog, graphData };
        }

        function calculate() {
            const years = parseInt(document.getElementById('years').value) || 0;
            const taxRate = (parseFloat(document.getElementById('taxRate').value) || 0) / 100;
            const inflationRate = (parseFloat(document.getElementById('inflationRate').value) || 0) / 100;

            const pA = {
                init: parseFloat(document.getElementById('initA').value) || 0,
                monthly: parseFloat(document.getElementById('monthlyA').value) || 0,
                interest: parseFloat(document.getElementById('interestA').value) || 0,
                acc: parseFloat(document.getElementById('feesAccA').value) || 0,
                dep: parseFloat(document.getElementById('feesDepA').value) || 0
            };

            const resA = runProjection(pA.init, pA.monthly, pA.interest, pA.acc, pA.dep, years);
            
            // Calculate Net & Real for A
            const netA = resA.balance - (resA.totalProfit * taxRate);
            const realA = resA.balance / Math.pow(1 + inflationRate, years);

            // Update Stats
            document.getElementById('statFinalBruto').innerText = 'â‚ª' + Math.round(resA.balance).toLocaleString();
            document.getElementById('statFinalNeto').innerText = 'â‚ª' + Math.round(netA).toLocaleString();
            document.getElementById('statRealValue').innerText = 'â‚ª' + Math.round(realA).toLocaleString();

            // Handle Table
            const tableBody = document.getElementById('yearlyTableBody');
            tableBody.innerHTML = resA.yearlyLog.map(row => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-2 border text-center font-bold">${row.year}</td>
                    <td class="p-2 border">â‚ª${row.start.toLocaleString()}</td>
                    <td class="p-2 border">â‚ª${row.deposits.toLocaleString()}</td>
                    <td class="p-2 border text-green-600">+â‚ª${row.profit.toLocaleString()}</td>
                    <td class="p-2 border text-red-500">-â‚ª${row.fees.toLocaleString()}</td>
                    <td class="p-2 border font-semibold">â‚ª${row.end.toLocaleString()}</td>
                </tr>
            `).join('');

            // Graph Data
            let datasets = [{
                label: '×ª×•×›× ×™×ª ×\'',
                data: resA.graphData,
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                fill: mode === 'single',
                tension: 0.3
            }];

            let resB = null;
            if (mode === 'compare') {
                const pB = {
                    init: parseFloat(document.getElementById('initB').value) || 0,
                    monthly: parseFloat(document.getElementById('monthlyB').value) || 0,
                    interest: parseFloat(document.getElementById('interestB').value) || 0,
                    acc: parseFloat(document.getElementById('feesAccB').value) || 0,
                    dep: parseFloat(document.getElementById('feesDepB').value) || 0
                };
                resB = runProjection(pB.init, pB.monthly, pB.interest, pB.acc, pB.dep, years);
                datasets.push({
                    label: '×ª×•×›× ×™×ª ×‘\'',
                    data: resB.graphData,
                    borderColor: '#f97316',
                    backgroundColor: 'transparent',
                    fill: false,
                    tension: 0.3
                });
            }

            updateChart(years, datasets);
            updateComparisonTable(resA, resB, taxRate, inflationRate, years);
        }

        function updateChart(years, datasets) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const labels = Array.from({length: years + 1}, (_, i) => i === 0 ? '×”×ª×—×œ×”' : '×©× ×” ' + i);

            if (mainChart) mainChart.destroy();
            mainChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { 
                        tooltip: { 
                            callbacks: { label: c => c.dataset.label + ': â‚ª' + c.parsed.y.toLocaleString() } 
                        },
                        legend: { position: 'top', rtl: true }
                    },
                    scales: { 
                        y: { ticks: { callback: v => 'â‚ª' + v.toLocaleString() }, position: 'right' } 
                    }
                }
            });
        }

        function updateComparisonTable(resA, resB, taxRate, inflationRate, years) {
            const container = document.getElementById('comparisonRows');
            const isCompare = mode === 'compare';
            
            const taxableProfitA = Math.max(0, resA.balance - resA.totalDeposited);
            const netA = resA.balance - (taxableProfitA * taxRate);
            const realA = resA.balance / Math.pow(1 + inflationRate, years);
            
            let netB = 0, realB = 0, taxableProfitB = 0;
            if (isCompare) {
                taxableProfitB = Math.max(0, resB.balance - resB.totalDeposited);
                netB = resB.balance - (taxableProfitB * taxRate);
                realB = resB.balance / Math.pow(1 + inflationRate, years);
            }

            const rows = [
                ["×¡×š ×”×›×œ ×”×•×Ÿ ×©×”×•×¤×§×“", `â‚ª${Math.round(resA.totalDeposited).toLocaleString()}`, isCompare ? `â‚ª${Math.round(resB.totalDeposited).toLocaleString()}` : "-"],
                ["×¡×š ×¨×•×•×— ×©× ×¦×‘×¨ (×‘×¨×•×˜×•)", `â‚ª${Math.round(resA.totalProfit).toLocaleString()}`, isCompare ? `â‚ª${Math.round(resB.totalProfit).toLocaleString()}` : "-"],
                ["×¡×š ×“××™ × ×™×”×•×œ ×©×©×•×œ××•", `â‚ª${Math.round(resA.totalFees).toLocaleString()}`, isCompare ? `â‚ª${Math.round(resB.totalFees).toLocaleString()}` : "-"],
                ["×¦×¤×™ ××¡ ×¨×•×•×—×™ ×”×•×Ÿ", `â‚ª${Math.round(taxableProfitA * taxRate).toLocaleString()}`, isCompare ? `â‚ª${Math.round(taxableProfitB * taxRate).toLocaleString()}` : "-"],
                ["×¡×›×•× ×¡×•×¤×™ ×‘×¨×•×˜×•", `â‚ª${Math.round(resA.balance).toLocaleString()}`, isCompare ? `â‚ª${Math.round(resB.balance).toLocaleString()}` : "-"],
                ["×¡×›×•× ×¡×•×¤×™ × ×˜×•", `â‚ª${Math.round(netA).toLocaleString()}`, isCompare ? `â‚ª${Math.round(netB).toLocaleString()}` : "-"],
                ["×¢×¨×š ×¨×™××œ×™ (×›×•×— ×§× ×™×™×”)", `â‚ª${Math.round(realA).toLocaleString()}`, isCompare ? `â‚ª${Math.round(realB).toLocaleString()}` : "-"]
            ];

            container.innerHTML = rows.map(r => `
                <tr class="border-b">
                    <td class="p-2 border bg-slate-50 font-semibold text-right">${r[0]}</td>
                    <td class="p-2 border text-center text-blue-700 font-bold">${r[1]}</td>
                    ${isCompare ? `<td class="p-2 border text-center text-orange-700 font-bold">${r[2]}</td>` : `<td class="p-2 border text-center text-slate-300">-</td>`}
                </tr>
            `).join('');
        }

        window.onload = () => {
            calculate();
        };
    </script>
</body>
</html>
